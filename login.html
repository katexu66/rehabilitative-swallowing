<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../style.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
        <title>Rehabilitative Swallowing</title>
    </head>
    <body>

      <h1>login page</h1>

    <!-- SUPABASE LOGIN -->
    <div class="form">
  <input id="email" class="input" placeholder="email" />
  <br>
  <input id="password" class="input" type="password" placeholder="password" />
  <br>
  <button id="login" class="button log-in">log in</button>
  <button id="logout" class="button log-in" hidden>log out</button>
</div>

<pre id="out"></pre>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://ehwsobpiwlpweujozwbo.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_SJkaqdhH9vWzai4fGvDDYA_AigoNqni";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const out = document.getElementById("out");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const loginBtn = document.getElementById("login");
  const logoutBtn = document.getElementById("logout");

  // ---- AUTH STATE HANDLER ----
  const updateUI = (session) => {
    const loggedIn = !!session;

    emailInput.hidden = loggedIn;
    passwordInput.hidden = loggedIn;
    loginBtn.hidden = loggedIn;
    logoutBtn.hidden = !loggedIn;

    out.textContent = loggedIn ? "Logged in" : "Logged out";
  };

  const { data: { session } } = await supabase.auth.getSession();
  updateUI(session);

  // Runs on load + any auth change
  supabase.auth.onAuthStateChange((_event, session) => {
    updateUI(session);
  });

  // ---- LOGIN ----
  loginBtn.onclick = async () => {
    const email = emailInput.value;
    const password = passwordInput.value;

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) out.textContent = error.message;
  };

  // ---- LOGOUT ----
  logoutBtn.onclick = async () => {
    await supabase.auth.signOut();
  };
</script>

    <hr>
    <p>back to <a href="./index.html" class="link">home</a></p>
    </body>
</html>
